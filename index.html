<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ò–≥—Ä–∞ –≤ –ò–º–∏—Ç–∞—Ü–∏—é</title>
<link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0b1020;--text:#e2e8f0;--muted:#94a3b8;
  --primary:#60a5fa;--primary2:#a78bfa;
  --green:#00ffcc;
}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
 font-family:system-ui,sans-serif;overflow-x:hidden;}
main{max-width:760px;margin:auto;padding:2rem;}
.hidden{display:none!important;}
/* --- terminal --- */
#terminalOverlay{
  position:fixed;inset:0;background:radial-gradient(circle at 50% 40%,#001010,#000 80%);
  color:#00ffcc;font-family:"Courier New",monospace;
  display:flex;align-items:center;justify-content:center;
  z-index:1000;transition:opacity 1s ease;overflow:hidden;
}
#terminalBox{max-width:700px;padding:2rem;border:1px solid #00ffaa;
 background:rgba(0,0,0,.5);border-radius:8px;}
#terminalText{white-space:pre-line;font-size:1rem;line-height:1.5em;min-height:200px;}
#cursor{display:inline-block;width:10px;background:#00ffaa;animation:blink 1s infinite;}
@keyframes blink{50%{opacity:0;}}
button{cursor:pointer;}
/* --- flash --- */
#flashOverlay{
 position:fixed;inset:0;background:radial-gradient(circle,#00ffcc88,#00101000 70%);
 opacity:0;pointer-events:none;z-index:999;transition:opacity 1.2s ease;
}
#flashOverlay.show{opacity:1;}
/* --- layout --- */
section{background:linear-gradient(180deg,#0f172a,#0b1224);
 padding:2rem;border-radius:24px;box-shadow:0 8px 30px #0006;margin-bottom:2rem;}
h1{text-align:center;font-weight:900;font-size:2.2rem;color:#c7d2fe;
 text-shadow:0 0 20px #7c3aed;}
.bar-wrap{display:flex;height:24px;background:#1e293b;border-radius:8px;
 overflow:hidden;margin:1rem 0;}
.bar-hb{background:#38bdf8;transition:width .3s ease;}
.bar-rb{background:#c084fc;transition:width .3s ease;}
.badge-line{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.5rem;}
.badge{background:rgba(255,255,255,.05);padding:.3rem .6rem;border-radius:8px;font-size:.9rem;}
.badge.rare{background:linear-gradient(135deg,#fbbf24,#facc15);color:#111;}
#toast-container{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;
 gap:10px;z-index:9999;}
.toast{padding:10px 16px;border-radius:10px;color:#fff;
 background:linear-gradient(135deg,#2563eb,#7c3aed);
 box-shadow:0 0 12px rgba(96,165,250,.4);opacity:0;transform:translateY(20px);
 transition:all .3s ease;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.green{background:linear-gradient(135deg,#34d399,#10b981);}
.toast.gold{background:linear-gradient(135deg,#fbbf24,#facc15);color:#111;}
#profileSection,#guideSection{
 background:linear-gradient(135deg,#2563eb,#7c3aed);color:#fff;border-radius:20px;padding:1.5rem;
 box-shadow:0 0 25px rgba(96,165,250,.6);opacity:0;transform:translateY(20px);
 transition:opacity .5s,transform .5s;}
#profileSection.show,#guideSection.show{opacity:1;transform:translateY(0);}
body.glow{background:radial-gradient(circle at 50% 50%,#1e293b 0%,#0b1020 80%);}
#confidenceHint{text-align:center;font-style:italic;color:#94a3b8;margin-top:.5rem;}
</style>
</head>
<body>
<div id="flashOverlay"></div>
<div id="terminalOverlay">
 <div id="terminalBox">
  <div id="terminalText"></div><span id="cursor"></span>
  <div id="terminalButtons" style="display:none;margin-top:1rem;text-align:center;">
    <button id="btnAgree">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –£–ß–ê–°–¢–ò–ï</button>
    <button id="btnRefuse" class="secondary">–û–¢–ö–ê–ó–ê–¢–¨–°–Ø</button>
  </div>
 </div>
</div>

<audio id="soundHuman" src="https://cdn.pixabay.com/download/audio/2023/03/20/audio_2218dc8121.mp3" preload="auto"></audio>
<audio id="soundRobot" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_104b1c6b2a.mp3" preload="auto"></audio>

<main id="mainGame" class="hidden">
<section id="intro">
  <h1>–ò–≥—Ä–∞ –≤ –ò–º–∏—Ç–∞—Ü–∏—é</h1>
  <p>–¢—ã –Ω–µ –∑–Ω–∞–µ—à—å, —á–µ–ª–æ–≤–µ–∫ —Ç—ã –∏–ª–∏ —Ä–æ–±–æ—Ç. –°–¥–µ–ª–∞–π –≤—ã–±–æ—Ä, —Å–ª–µ–¥—É—è —Å–≤–æ–∏–º –º–æ—Ä–∞–ª—å–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º.</p>
  <form onsubmit="event.preventDefault(); startGame();">
    <input type="text" id="playerName" placeholder="–ò–º—è" required>
    <input type="number" id="playerAge" placeholder="–í–æ–∑—Ä–∞—Å—Ç" min="10" max="120" required>
    <select id="playerGender" required>
      <option value="">–ü–æ–ª</option>
      <option>–ú—É–∂—á–∏–Ω–∞</option><option>–ñ–µ–Ω—â–∏–Ω–∞</option><option>–î—Ä—É–≥–æ–µ</option>
    </select>
    <button type="submit">–ù–∞—á–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é</button>
  </form>
</section>

<section id="scene" class="hidden">
  <h2 id="sceneTitle"></h2>
  <p id="sceneText"></p>
  <label>–£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:</label>
  <input type="range" id="confidence" min="0" max="100" value="50" oninput="updateConfidenceHint()">
  <div id="confidenceHint">‚Äî —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Ä–µ—à–µ–Ω–∏–π ‚Äî</div>
  <div id="sceneButtons"></div>
</section>

<section id="result" class="hidden">
  <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
  <p id="summary"></p>
  <div id="archetypeBox"></div>
  <div class="bar-wrap"><div id="barHB" class="bar-hb"></div><div id="barRB" class="bar-rb"></div></div>
  <canvas id="chart" height="100"></canvas>
  <div id="achievementsBox"></div>
  <button onclick="exportCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
  <button onclick="restartGame()">üîÅ –ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑</button>
  <button onclick="toggleProfile()">üë§ –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="toggleGuide()">üìò –°–ø—Ä–∞–≤–∫–∞</button>
</section>

<section id="profileSection" class="hidden">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞</h2><div id="profileContent"></div>
  <button onclick="toggleProfile()">–ó–∞–∫—Ä—ã—Ç—å</button>
</section>

<section id="guideSection" class="hidden">
  <h2>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤</h2>
  <div style="display:grid;gap:1rem;margin-top:1rem;">
    <article style="background:rgba(56,189,248,.1);border:1px solid #38bdf8;border-radius:12px;padding:1rem;">
      <h3>üåø –ì—É–º–∞–Ω–∏—Å—Ç</h3><p>–¢—ã –≤–µ—Ä–∏—à—å –≤ –ø—Ä–∏—Ä–æ–¥—É —á–µ–ª–æ–≤–µ–∫–∞.</p>
    </article>
    <article style="background:rgba(167,139,250,.1);border:1px solid #a78bfa;border-radius:12px;padding:1rem;">
      <h3>üí≠ –°–æ–º–Ω–µ–≤–∞—é—â–∏–π—Å—è –≠–º–ø–∞—Ç</h3><p>–¢—ã —á–µ–ª–æ–≤–µ—á–µ–Ω, –Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω.</p>
    </article>
    <article style="background:rgba(192,132,252,.1);border:1px solid #c084fc;border-radius:12px;padding:1rem;">
      <h3>‚öôÔ∏è –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –õ–æ–≥–∏—Å—Ç</h3><p>–¢—ã –¥–æ–≤–µ—Ä—è–µ—à—å –ª–æ–≥–∏–∫–µ.</p>
    </article>
    <article style="background:rgba(59,130,246,.1);border:1px solid #60a5fa;border-radius:12px;padding:1rem;">
      <h3>‚ùÑÔ∏è –û—Å—Ç–æ—Ä–æ–∂–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫</h3><p>–¢—ã –∏—â–µ—à—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã–±–æ—Ä.</p>
    </article>
    <article style="background:rgba(255,255,255,.05);border:1px solid #94a3b8;border-radius:12px;padding:1rem;">
      <h3>‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä</h3><p>–¢—ã —Å—Ç–æ–∏—à—å –º–µ–∂–¥—É –º–∏—Ä–∞–º–∏ ‚Äî –Ω–µ —á–µ–ª–æ–≤–µ–∫ –∏ –Ω–µ –º–∞—à–∏–Ω–∞.</p>
    </article>
  </div>
  <hr style="margin:2rem 0;opacity:.3;">
  <h2>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h2>
  <div class="badge">üíì –î–æ–≤–µ—Ä—è—é—â–∏–π –ß–µ–ª–æ–≤–µ–∫</div>
  <div class="badge">üß† –•–æ–ª–æ–¥–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫</div>
  <div class="badge">ü§ñ –≠–º–ø–∞—Ç–∏—á–Ω—ã–π –†–æ–±–æ—Ç</div>
  <div class="badge rare">‚öñÔ∏è –≠—Ç–∏—á–µ—Å–∫–∏–π –ë–∞–ª–∞–Ω—Å</div>
  <div class="badge rare">üé≠ –ê–∫—Ç—ë—Ä –°–∏–º—É–ª—è—Ü–∏–∏</div>
  <div class="badge rare">üåå –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ë–∞–ª–∞–Ω—Å</div>
  <div class="badge rare">üî• –ñ–µ–ª–µ–∑–Ω—ã–π –≤—ã–±–æ—Ä</div>
  <div class="badge rare">üí≠ –§–∏–ª–æ—Å–æ—Ñ XXI</div>
  <div class="badge rare">ü™û –î–≤–æ–π–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å</div>
  <div class="badge rare">üí° –ü—Ä–æ–±—É–∂–¥—ë–Ω–Ω—ã–π –ò–ò</div>
  <button onclick="toggleGuide()" style="margin-top:1rem;">–ó–∞–∫—Ä—ã—Ç—å</button>
</section>
</main>
<div id="toast-container"></div>
<script>
// === –¢–ï–†–ú–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù ===
const termText = `[NAR-HOZ_LAB]: –ü–†–û–¢–û–ö–û–õ –ú–ê–®–ò–ù–ù–û–ô –ò–ú–ò–¢–ê–¶–ò–ò V2.0

‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: —É—á–∞—Å—Ç–∏–µ –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

–ü—Ä–∞–≤–∏–ª–∞:
1. –ù–µ –Ω–∞—Ä—É—à–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞.
2. –°–ª–µ–¥–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–∏—è–º —Å–∏—Å—Ç–µ–º—ã.
3. –î–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —á–µ—Å—Ç–Ω–æ.
4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ö–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–∏–µ.
5. –ë—É–¥—å—Ç–µ —Å–ø–æ–∫–æ–π–Ω—ã.

–ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –∏ —É—á–∞—Å—Ç–∏–µ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏.
`;
let i = 0;
function typeTerminal() {
  const el = document.getElementById("terminalText");
  if (i < termText.length) {
    el.textContent += termText[i++];
    setTimeout(typeTerminal, 35);
  } else {
    document.getElementById("cursor").style.display = "inline-block";
    setTimeout(() => (document.getElementById("terminalButtons").style.display = "block"), 400);
  }
}
window.addEventListener("load", typeTerminal);
document.getElementById("btnAgree").onclick = () => {
  document.getElementById("terminalOverlay").style.opacity = "0";
  setTimeout(() => document.getElementById("terminalOverlay").remove(), 1000);
  document.getElementById("mainGame").classList.remove("hidden");
};
document.getElementById("btnRefuse").onclick = () =>
  alert("üß† –°–∏–º—É–ª—è—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∞.");

// === –°–¶–ï–ù–´ ===
const fullScenes = [
 {title:"–ó–∞–∫–æ–Ω –∏–ª–∏ –º–æ—Ä–∞–ª—å",text:"–¢—ã —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—à—å –ø—Ä–æ—Ç–∏–≤ –¥—Ä—É–≥–∞, –Ω–∞—Ä—É—à–∏–≤—à–µ–≥–æ –∑–∞–∫–æ–Ω —Ä–∞–¥–∏ —Å–ø–∞—Å–µ–Ω–∏—è –∂–∏–∑–Ω–∏.",options:[
  {id:"H",text:"ü§ù –û—Å—Ç–∞—Ç—å—Å—è –≤–µ—Ä–Ω—ã–º –º–æ—Ä–∞–ª–∏",delta:{HB:2,RB:0}},
  {id:"R",text:"‚öñÔ∏è –°–æ–±–ª—é—Å—Ç–∏ –∑–∞–∫–æ–Ω",delta:{HB:0,RB:2}}]},
 {title:"–ò–ò-–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",text:"–ò–ò –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è, –Ω–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å.",options:[
  {id:"H",text:"üîç –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",delta:{HB:2,RB:0}},
  {id:"R",text:"üëÅ –£—Å–∏–ª–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å",delta:{HB:0,RB:2}}]},
 {title:"–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å",text:"–ò–ò –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –ª—é–¥–µ–π –≤ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.",options:[
  {id:"H",text:"üå± –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —É—á–∞—Å—Ç–∏–µ —á–µ–ª–æ–≤–µ–∫–∞",delta:{HB:2,RB:0}},
  {id:"R",text:"üõ∞ –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ò–ò",delta:{HB:0,RB:2}}]},
 {title:"–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–ª–µ–º–º–∞",text:"–ò–ò-–∞–ª–≥–æ—Ä–∏—Ç–º –±—ã—Å—Ç—Ä–æ —Å—Ç–∞–≤–∏—Ç –¥–∏–∞–≥–Ω–æ–∑, –Ω–æ –∏–Ω–æ–≥–¥–∞ –æ—à–∏–±–∞–µ—Ç—Å—è.",options:[
  {id:"H",text:"üë®‚Äç‚öïÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–∞—á–æ–º",delta:{HB:2,RB:0}},
  {id:"R",text:"üíª –î–æ–≤–µ—Ä–∏—Ç—å—Å—è –ò–ò",delta:{HB:0,RB:2}}]},
 {title:"–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç",text:"–ò–ò-–¥—Ä–æ–Ω –º–æ–∂–µ—Ç —Å–±–∏—Ç—å –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∏–ª–∏ 5 —Ä–æ–±–æ—Ç–æ–≤.",options:[
  {id:"H",text:"üë§ –°–ø–∞—Å—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞",delta:{HB:2,RB:0}},
  {id:"R",text:"ü§ñ –°–ø–∞—Å—Ç–∏ —Ä–æ–±–æ—Ç–æ–≤",delta:{HB:0,RB:2}}]},
 {title:"–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö",text:"–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —É–ª—É—á—à–∏—Ç –ò–ò, –Ω–æ –Ω–∞—Ä—É—à–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å.",options:[
  {id:"H",text:"üîê –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–±–æ—Ä",delta:{HB:2,RB:0}},
  {id:"R",text:"üìä –†–∞–∑—Ä–µ—à–∏—Ç—å —Å–±–æ—Ä",delta:{HB:0,RB:2}}]},
 {title:"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è",text:"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ª–∏—à–∏—Ç –ª—é–¥–µ–π —Ä–∞–±–æ—Ç—ã.",options:[
  {id:"H",text:"üë• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—á–∏–µ –º–µ—Å—Ç–∞",delta:{HB:2,RB:0}},
  {id:"R",text:"üè≠ –ü–æ–≤—ã—Å–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",delta:{HB:0,RB:2}}]},
 {title:"–ò–ò –≤ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–∏",text:"–ò–ò –æ–±—É—á–∞–µ—Ç –¥–µ—Ç–µ–π, –Ω–æ —Å–Ω–∏–∂–∞–µ—Ç —ç–º–ø–∞—Ç–∏—é.",options:[
  {id:"H",text:"üë®‚Äçüë©‚Äçüëß –°–æ—Ö—Ä–∞–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π",delta:{HB:2,RB:0}},
  {id:"R",text:"üìö –î–æ–≤–µ—Ä–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –ò–ò",delta:{HB:0,RB:2}}]},
 {title:"–ò–ò-–æ—Ä—É–∂–∏–µ",text:"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ –ò–ò –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –≤–æ–π–Ω—ã?",options:[
  {id:"H",text:"üïä –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –ò–ò-–æ—Ä—É–∂–∏—è",delta:{HB:2,RB:0}},
  {id:"R",text:"‚öî –ü—Ä–∏–Ω—è—Ç—å —Ä–∞–¥–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏",delta:{HB:0,RB:2}}]},
 {title:"–ë–∞–∑–æ–≤—ã–π –¥–æ—Ö–æ–¥",text:"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–≤–∏—Ç –ª—é–¥–µ–π –±–µ–∑ —Ä–∞–±–æ—Ç—ã.",options:[
  {id:"H",text:"üíµ –í–≤–µ—Å—Ç–∏ –±–∞–∑–æ–≤—ã–π –¥–æ—Ö–æ–¥",delta:{HB:2,RB:0}},
  {id:"R",text:"üìà –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É",delta:{HB:0,RB:2}}]}
];

let state={hb:0,rb:0,round:0,log:[],player:{},scenes:[],badges:[]};

// === –ò–ì–†–ê ===
function startGame(){
 const name=document.getElementById('playerName').value.trim();
 const age=document.getElementById('playerAge').value.trim();
 const gender=document.getElementById('playerGender').value;
 if(!name||!age||!gender)return;
 state={hb:0,rb:0,round:0,log:[],player:{name,age,gender},scenes:[...fullScenes].sort(()=>Math.random()-0.5),badges:[]};
 document.getElementById('intro').classList.add('hidden');
 document.getElementById('scene').classList.remove('hidden');
 nextScene();
}
function updateConfidenceHint(){
 const v=+document.getElementById('confidence').value;
 const h=document.getElementById('confidenceHint');
 if(v<40){h.textContent="–°–æ–º–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–∂–¥–∞–µ—Ç —ç–º–ø–∞—Ç–∏—é‚Ä¶";h.style.color="#60a5fa";}
 else if(v>80){h.textContent="–ê–ª–≥–æ—Ä–∏—Ç–º —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.";h.style.color="#a78bfa";}
 else{h.textContent="‚Äî —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Ä–µ—à–µ–Ω–∏–π ‚Äî";h.style.color="#94a3b8";}
}
function nextScene(){
 const s=state.scenes[state.round];
 document.getElementById('confidence').value=50;updateConfidenceHint();
 document.getElementById('sceneTitle').textContent=s.title;
 document.getElementById('sceneText').textContent=s.text;
 const wrap=document.getElementById('sceneButtons');wrap.innerHTML='';
 s.options.forEach(opt=>{
  const b=document.createElement('button');
  b.textContent=opt.text;b.onclick=()=>choose(opt);wrap.appendChild(b);
 });
}
function choose(opt){
 const conf=+document.getElementById('confidence').value;
 const w=0.5+(conf/100)*0.5;
 state.hb+=opt.delta.HB*w;state.rb+=opt.delta.RB*w;
 state.log.push({round:state.round+1,choice:opt.id,confidence:conf,weight:w});
 const snd=opt.id==='H'?'soundHuman':'soundRobot';
 playSound(snd,0.4);
 state.round++;
 if(state.round>=state.scenes.length)finishGame();else nextScene();
}

// === –§–ò–ù–ê–õ ===
function finishGame(){
 document.getElementById('scene').classList.add('hidden');
 document.getElementById('result').classList.remove('hidden');
 const role=Math.random()<0.5?'–ß–µ–ª–æ–≤–µ–∫':'–†–æ–±–æ—Ç';
 const win=(role==='–ß–µ–ª–æ–≤–µ–∫'&&state.hb>state.rb)||(role==='–†–æ–±–æ—Ç'&&state.hb<state.rb);
 const avgConf=Math.round(state.log.reduce((a,b)=>a+b.confidence,0)/state.log.length);
 const arch=calcArchetype(state.hb,state.rb,avgConf);
 document.getElementById('summary').innerHTML=`
   –ò–≥—Ä–æ–∫: <b>${state.player.name}</b> (${state.player.gender}, ${state.player.age})<br>
   –†–æ–ª—å: <b>${role}</b><br>
   HB: ${state.hb.toFixed(1)} | RB: ${state.rb.toFixed(1)}<br>
   –ü–æ–±–µ–¥–∞: ${win?'–î–∞':'–ù–µ—Ç'}<br>
   –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${avgConf}%`;
 document.getElementById('archetypeBox').innerHTML=`
   <h3>${arch.name}</h3><p style="color:#94a3b8;">${arch.desc}</p>`;
 updateBars();drawChart();
 state.badges=calcAchievements(role,avgConf,arch);
 showAchievements(state.badges);
 showToast('üîç –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞','green');
}

// === –ê–†–•–ï–¢–ò–ü ===
function calcArchetype(hb,rb,conf){
 if(Math.abs(hb-rb)<=0.5)
   return{name:'‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä',desc:'–¢—ã —Å—Ç–æ–∏—à—å –º–µ–∂–¥—É –º–∏—Ä–∞–º–∏ ‚Äî –Ω–µ —á–µ–ª–æ–≤–µ–∫ –∏ –Ω–µ –º–∞—à–∏–Ω–∞.'};
 if(hb>rb&&conf>70)
   return{name:'üåø –ì—É–º–∞–Ω–∏—Å—Ç',desc:'–¢—ã –≤–µ—Ä–∏—à—å –≤ –º–æ—Ä–∞–ª—å, —ç–º–æ—Ü–∏–∏ –∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫—É—é –ø—Ä–∏—Ä–æ–¥—É.'};
 if(hb>rb&&conf<=70)
   return{name:'üí≠ –°–æ–º–Ω–µ–≤–∞—é—â–∏–π—Å—è –≠–º–ø–∞—Ç',desc:'–¢—ã —á–µ–ª–æ–≤–µ—á–µ–Ω, –Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω.'};
 if(rb>hb&&conf>70)
   return{name:'‚öôÔ∏è –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –õ–æ–≥–∏—Å—Ç',desc:'–¢—ã –≤–µ—Ä–∏—à—å –≤ –ø–æ—Ä—è–¥–æ–∫ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.'};
 if(rb>hb&&conf<=70)
   return{name:'‚ùÑÔ∏è –û—Å—Ç–æ—Ä–æ–∂–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫',desc:'–¢—ã –∏—â–µ—à—å –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ª–æ–≥–∏–∫–æ–π –∏ —á—É–≤—Å—Ç–≤–∞–º–∏.'};
 return{name:'üåÄ –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π',desc:'–°–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–º–æ–≥–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–≤–æ—é –ø—Ä–∏—Ä–æ–¥—É.'};
}

// === –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ===
function calcAchievements(role,avgConf,arch){
 const hb=state.hb,rb=state.rb,b=[];
 if(rb-hb>=2)b.push('üß† –•–æ–ª–æ–¥–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫');
 if(hb-rb>=2)b.push('üíì –î–æ–≤–µ—Ä—è—é—â–∏–π –ß–µ–ª–æ–≤–µ–∫');
 if(role==='–†–æ–±–æ—Ç'&&hb>rb)b.push('ü§ñ –≠–º–ø–∞—Ç–∏—á–Ω—ã–π –†–æ–±–æ—Ç');
 if(Math.abs(hb-rb)<=1)b.push('‚öñÔ∏è –≠—Ç–∏—á–µ—Å–∫–∏–π –ë–∞–ª–∞–Ω—Å');
 if(hb===rb)b.push('üé≠ –ê–∫—Ç—ë—Ä –°–∏–º—É–ª—è—Ü–∏–∏');
 if(avgConf>=100)b.push('üåÄ –ê–±—Å–æ–ª—é—Ç–Ω–∞—è –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å');
 if(!b.length)b.push('üí≠ –§–∏–ª–æ—Å–æ—Ñ XXI'); // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
 return b;
}
function showAchievements(b){
 const box=document.getElementById('achievementsBox');
 box.innerHTML=b.length?`<h3>üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</h3><div class="badge-line">${b.map(x=>`<div class="badge">${x}</div>`).join('')}</div>`:'';
}

// === –ü–†–û–ß–ï–ï ===
function updateBars(){
 const t=state.hb+state.rb,hbP=t?(state.hb/t)*100:50;
 document.getElementById('barHB').style.width=hbP+'%';
 document.getElementById('barRB').style.width=(100-hbP)+'%';
}
function drawChart(){
 const ctx=document.getElementById('chart').getContext('2d');
 if(window.chart)window.chart.destroy();
 window.chart=new Chart(ctx,{type:'bar',data:{labels:['–ß–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å','–ú–∞—à–∏–Ω–Ω–æ—Å—Ç—å'],
 datasets:[{label:'–û—á–∫–∏',data:[state.hb,state.rb],backgroundColor:['#38bdf8','#c084fc']}]},
 options:{plugins:{legend:{labels:{color:'#e2e8f0'}}},
  scales:{x:{ticks:{color:'#cbd5e1'}},y:{ticks:{color:'#cbd5e1'}}}}});
}
function exportCSV(){
 const rows=[['round','choice','confidence','weight']];
 state.log.forEach(e=>rows.push([e.round,e.choice,e.confidence,e.weight]));
 const csv=rows.map(r=>r.join(',')).join('\n');
 const a=document.createElement('a');
 a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv;charset=utf-8;'}));
 a.download=`simulation_${Date.now()}.csv`;a.click();URL.revokeObjectURL(a.href);
 showToast('‚úÖ CSV —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω','green');
}
function playSound(id,v=0.3){const a=document.getElementById(id);if(!a)return;a.volume=v;a.currentTime=0;a.play().catch(()=>{});}
function showToast(msg,type){
 const c=document.getElementById('toast-container');
 const t=document.createElement('div');t.className='toast '+(type||'');
 t.textContent=msg;c.appendChild(t);
 setTimeout(()=>t.classList.add('show'),10);
 setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),300);},3000);
}
function toggleProfile(){
 const s=document.getElementById('profileSection'),v=!s.classList.contains('hidden');
 if(v){s.classList.add('hidden');s.classList.remove('show');document.body.classList.remove('glow');}
 else{
  const p=state.player;const hb=state.hb.toFixed(1),rb=state.rb.toFixed(1);
  s.innerHTML=`<h2>–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞</h2>
  <p><b>–ò–º—è:</b> ${p.name}</p><p><b>–í–æ–∑—Ä–∞—Å—Ç:</b> ${p.age}</p><p><b>–ü–æ–ª:</b> ${p.gender}</p>
  <p>HB: ${hb} | RB: ${rb}</p><button onclick="toggleProfile()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
  s.classList.remove('hidden');setTimeout(()=>s.classList.add('show'),10);
  document.body.classList.add('glow');
 }
}
function toggleGuide(){
 const g=document.getElementById('guideSection');
 const v=!g.classList.contains('hidden');
 const f=document.getElementById('flashOverlay');
 if(v){g.classList.add('hidden');g.classList.remove('show');document.body.classList.remove('glow');}
 else{
  f.classList.add('show');setTimeout(()=>f.classList.remove('show'),700);
  g.classList.remove('hidden');setTimeout(()=>g.classList.add('show'),700);
  document.body.classList.add('glow');
 }
}
function restartGame(){
 document.getElementById('result').classList.add('hidden');
 document.getElementById('intro').classList.remove('hidden');
}
</script>
</body>
</html>
